---
title: "ReproducibleResearch_CourseProject1"
author: "Author: sagiff"
date: "`r Sys.Date()`"
output: html_document
---

```{r, setup, include=FALSE}
  knitr::opts_chunk$set(echo = TRUE, include = TRUE)
```

[Assignment Description:]{.underline} This assignment makes use of data from a personal activity monitoring device. This device collects data at 5 minute intervals through out the day. The data consists of two months of data from an anonymous individual collected during the months of October and November, 2012 and include the number of steps taken in 5 minute intervals each day.

------------------------------------------------------------------------

#### [**Loading and pre-processing the data:**]{.underline}

Load necessary libraries

```{r Load Libraries, message=FALSE, warning=FALSE}
  library(dplyr)
  library(ggplot2)
```

File existence check

```{r File Existence Check}
  if(!file.exists("activity.csv")) {
    stop(paste("File does not exist:", "activity.csv"))
  }
```

Read CSV

```{r Read CSV}
  activity <- read.csv("activity.csv")
```

Convert dates to class 'Date'

```{r Convert date}
  activity$date <- as.Date(activity$date, format = "%Y-%m-%d")
```

Convert interval time strings to total minutes

```{r Convert interval}
  convert_to_minutes <- function(x) {
    if (nchar(x) > 2) {
      hours <- as.numeric(substr(x, 1, nchar(x) - 2))   ##Get hours - all digits up to the second-to-last
      minutes <- as.numeric(substr(x, nchar(x) - 1, nchar(x)))    ##Get minutes - all digits from second-to-last and beyond
    } else {
      hours <- 0
      minutes <- as.numeric(x)
    }
    
    total_minutes <- (hours * 60) + minutes   ##Calculate total minutes
    return(total_minutes)
  }

  activity$interval <- sapply(activity$interval, convert_to_minutes)
```

------------------------------------------------------------------------

#### [**What is the mean total number of steps taken per day?**]{.underline}

Summarize the data by date (calculate total steps per day, mean steps per day, and median steps per day)

```{r Summarize by date}
  activity_summary <- activity %>% group_by(date) %>% summarise(steps_total = as.numeric(sum(steps, na.rm = TRUE)), steps_mean = mean(steps, na.rm = TRUE), steps_median = median(steps, na.rm = TRUE))
```

Convert to data frame

```{r Convert to data frame}
  activity_summary <- as.data.frame(activity_summary)
```

Report mean and median steps per day

```{r Report mean and median}
  print(activity_summary[, c(1, 3, 4)])
```

Plot a histogram of total number of steps taken each day

```{r Plot histogram of total steps per day}
  with(activity_summary, hist(steps_total, breaks = 19, main = "Total Steps", xlab = "Total Steps per Day", ylab = "Frequency", xaxt = "n", yaxt = "n"))
  axis(2, at = seq(0, 10, by = 2), labels = FALSE)
  text(x = par("usr")[1] - 1000, y = seq(0, 10, by = 2), labels = seq(0, 10, by = 2), cex = 0.75, srt = 45, xpd = TRUE)
  axis(1, at = seq(0, 22000, by = 1000), labels = FALSE)
  text(x = seq(0, 22000, by = 1000), y = par("usr")[3] - 1.1, labels = seq(0, 22000, by = 1000), cex = 0.6, srt = 45, xpd = TRUE)
```

------------------------------------------------------------------------

#### [**What is the average daily activity pattern?**]{.underline}

Summarize the data by 5-minute interval (calculate average number of steps across all days)

```{r, Summarize by interval}
  activity_summary2 <- activity %>% group_by(interval) %>% summarise(steps_mean = mean(steps, na.rm = TRUE))
```

Convert to data frame

```{r, Convert to data frame 2}
  activity_summary2 <- as.data.frame(activity_summary2)
```

Plot a time series plot of average steps taken across all days (y-axis) by interval (x-axis)

```{r, Plot time series of steps by interval, fig.width = 40, fig.height = 20}
  par(mar = c(5, 4, 4, 2) + 6)
  with(activity_summary2, plot(interval, steps_mean, type = "l", xaxt = "n", yaxt = "n", main = "", xlab = "", ylab = "")) 
  title(main = "Average Steps (across all days) by Interval", line = 2, cex.main = 4)
  title(xlab = "Interval (minutes)", ylab = "Average Steps (all days)", line = 6, cex.lab = 3)
  axis(2, at = seq(0, 200, by = 20), labels = FALSE)
  text(x = par("usr")[1] - 15, y = seq(0, 200, by = 20), labels = seq(0, 200, by = 20), cex = 2, srt = 45, adj = 1.25, xpd = TRUE)
  axis(1, at = seq(0, 1440, by = 20), labels = FALSE)
  text(x = seq(0, 1440, by = 20), y = par("usr")[3] - 3, labels = seq(0, 1440, by = 20), cex = 1.75, srt = 45, adj = 1.25, xpd = TRUE)
  abline(v = activity_summary2$interval[which.max(activity_summary2$steps_mean)], col = "red")
  text(x = 630, y = 207, label = "Max Average = 206, Interval = 835", col = "black", cex = 2)
```

The 5-minute interval that contains the maximum number of steps across all days in the data set is at 835 minutes (at about 13:54)

------------------------------------------------------------------------

#### [**Imputing missing values**]{.underline}

Calculate the total number of missing values in the data set

```{r Calculate number of missing values}
  missing_rows <- activity %>% group_by(date) %>% summarise(missing_count = sum(is.na(steps)))
  result <- missing_rows[missing_rows$missing_count == 288, ]
  sum(result$missing_count)
```

Determine which days contain NA values

```{r Determind days with NA values}
  print(result)
```

Use steps_mean (mean steps by interval) to impute missing data

```{r Impute data}
  activity$steps_imputed <- replace(activity$steps, is.na(activity$steps), activity_summary2$steps_mean)
```

Summarize the data by date (calculate total steps per day, mean steps per day, and median steps per day)

```{r Summarize by date 2}
  activity_summary3 <- activity %>% group_by(date) %>% summarise(steps_total = as.numeric(sum(steps_imputed, na.rm = TRUE)), steps_mean = mean(steps_imputed, na.rm = TRUE), steps_median = median(steps_imputed, na.rm = TRUE))
```

Convert to data frame

```{r, Convert to data frame 3}
  activity_summary3 <- as.data.frame(activity_summary3)
```

Report mean and median steps per day

```{r, Report mean and median 2}
  print(activity_summary3[, c(1, 3, 4)])
```

Plot a histogram of total number of steps taken each day

```{r Plot histogram of steps each day}
  with(activity_summary3, hist(steps_total, breaks = 19, main = "Total Steps (with imputed data)", xlab = "Total Steps per Day", ylab = "Frequency", xaxt = "n", yaxt = "n"))
  axis(2, at = seq(0, 18, by = 2), labels = FALSE)
  text(x = par("usr")[1] - 1000, y = seq(0, 18, by = 2), labels = seq(0, 18, by = 2), cex = 0.75, srt = 45, xpd = TRUE)
  axis(1, at = seq(0, 22000, by = 1000), labels = FALSE)
  text(x = seq(0, 22000, by = 1000), y = par("usr")[3] - 2, labels = seq(0, 22000, by = 1000), cex = 0.6, srt = 45, xpd = TRUE)
```

------------------------------------------------------------------------

#### [**Are there differences in activity patterns between weekdays and weekends?**]{.underline}

Create a new factor variable with two levels - "weekday" and "weekend"

```{r Create factor variable}
  activity$day <- weekdays(activity$date)
  activity <- activity %>% mutate(group = factor(ifelse(day %in% c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday"), "Weekday", "Weekend")))
```

Summarize the data by group (calculate total steps per day, mean steps per day)

```{r Summarize by group}
  activity_summary4 <- activity %>% group_by(interval) %>% reframe(steps_total = as.numeric(sum(steps_imputed, na.rm = TRUE)), steps_mean = mean(steps_imputed, na.rm = TRUE), group = group)
```

Convert to data frame

```{r Convert to data frame 4}
  activity_summary4 <- as.data.frame(activity_summary4)
```

Create a panel plot containing a time series plot of the 5-minute interval (x-axis) and avg. steps across all week/weekend days (y-axis)

```{r Plot interval and steps across days, fig.width = 20, fig.height = 15, echo = TRUE}
  g <- ggplot(activity_summary4, aes(interval, steps_mean))
  g + geom_line() + facet_grid(rows = vars(group)) + facet_wrap(vars(group), axes = "all", nrow = 2, strip.position = "right") + scale_x_continuous(breaks = seq(0, 1500, by = 20), labels = seq(0, 1500, by = 20)) + theme(axis.text.x = element_text(size = 12, angle = 45, hjust = 1)) + scale_y_continuous(breaks = seq(0, 200, by = 20), labels = seq(0, 200, by = 20)) + theme(axis.text.y = element_text(size = 12, angle = 45, hjust = 1), strip.text = element_text(size = 16)) + labs(title = "Average Steps (across all days) by Interval", subtitle = "Weekday Compared to Weekend", x = "Interval (minutes)", y = "Average Steps (all days)") + theme(plot.title = element_text(size = 20, hjust = 0.5), plot.subtitle = element_text(size = 18, hjust = 0.5), axis.title.x = element_text(size = 14), axis.title.y = element_text(size = 14))
```
